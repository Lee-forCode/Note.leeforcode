#  MySQL的安装

>windows系统
>
>Linux/Unix操作系统
>
>安装路径：`/application/mysql`

[TOC]



## 1、Linux系统安装方法 – – CentOS7

### 1.1 yum / rpm安装

#### 1）rpm安装（安装版本较新、无法自定义安装）

- 从镜像网站下载：https://mirrors.tuna.tsinghua.edu.cn/mysql/downloads/MySQL-5.6/

```bash
# 下载MySQL相关软件包
mysql-client-x.x.xx-x.el7.x86_64.rpm (必需)
mysql-devel-x.x.xx-x.el7.x86_64.rpm
mysql-sever-x.x.xx-x.el7.x86_64.rpm  （必需）
mysql-shared-x.x.xx-x.el7.x86_64.rpm

```

#### 2）yum安装

```bash
# 一行命令
yum install mysql-server -y
	
```

### 1.2 常规方式 编译安装

>MySQL安装三部曲：
>
>`./configure`
>
>`make`
>
>`make install`

### 1.3 采用 cmake 编译安装

>三部曲
>
>`cmake`
>
>`make`
>
>`make install`

### 1.4 采用二进制方式免编译安装

### ✅1.5 如何选择MySQL的安装方式？

- 对数据库要求不高的场景 – – ``可以采用 yum / rpm安装``
  - 并发不高：只在公司内部（wiki系统）、企业内部（Zabbix监控系统、OpenStack后台管理）
  - 企业内部，定制化的MySQL，生成rpm包，并搭建自己的 yum 仓库，使用 yum / rpm安装即可
- 机器数量少：使用 cmake
- 机器数量多：二进制包安装

------

#### 自动化运维必备技能 – – 定制自己的rpm包

#### 自动化运维必备 – – 搭建自己的yum仓库

------

## 2、MySQL的安装和配置（cmake、yum/rpm安装）

### 2.1 Linux系统环境

**1）操作系统版本**

```
[root@centos7001 ~]# cat /etc/redhat-release 
CentOS Linux release 7.9.2009 (Core)

```

**2）内核版本和主机硬件类型**

```
[root@centos7001 ~]# uname -r
3.10.0-1160.el7.x86_64
# 主机硬件类型
[root@centos7001 ~]# uname -m
x86_64

```

### 2.2 安装MySQL的依赖包和编译软件

>`openssl-devel`
>
>`ncurses-devel`
>
>`libaio-devel`

**1）安装依赖包**

```
root@centos7001 ~]# yum install ncurses-devel libaio-devel -y
# 检查安装结果
[root@centos7001 ~]# rpm -qa ncurses-devel libaio-devel
libaio-devel-0.3.109-13.el7.x86_64
ncurses-devel-5.9-14.20130511.el7_4.x86_64


```

**2）编译软件`cmake`**

>依赖包：`gcc-c++`、`cmake`、`bison-devel`
>
>

```
[root@centos7001 ~]# yum install cmake -y
# 检查安装结果
[root@centos7001 ~]# rpm -qa cmake
cmake-2.8.12.2-2.el7.x86_64

```

### 2.3 开始安装MySQL

**1）建立MySQL用户账号**

- 添加到`/usr/sbin/nologin`，用于管理MySQL – – 无法登陆linux主机

- 不需要创建登入目录（家目录）

- 系统自动创建同名组

- 更改`安装目录的 所有组：所有者 = mysql:mysql`

  ```
  [root@centos7001 ~]# useradd -s /sbin/nologin -M mysql
  # 查询是否创建成功
  [root@centos7001 ~]# id mysql
  uid=1001(mysql) gid=1001(mysql) 组=1001(mysql)
  
  ```

**2）软件包获取**（mysql-x.x.x.tar.gz）

- 下载到本地，通过`rz`工具上传到虚拟机

- 通过`wget+链接` 直接下载

  ```
  [root@centos7001 tools]# wget -q https://mirrors.tuna.tsinghua.edu.cn/mysql/downloads/MySQL-5.6/mysql-5.6.50.tar.gz
  # 检查下载情况
  [root@centos7001 tools]# ls
  mysql-5.6.50.tar.gz
  
  ```



**3）解压并配置MySQL**

- 配置参数说明![image-20210929095227683](C:\Users\LGB\AppData\Roaming\Typora\typora-user-images\image-20210929095227683.png)

  ```bash
  #安装目录
  cmake -DCMAKE_INSTALL_PREFIX=/usr/local/mysql 
  #数据库存放目录
  -DMYSQL_DATADIR=/usr/local/mysql/data 
  #系统配置目录
  -DSYSCONFDIR=/etc
  #Unix socket 文件路径
  -DMYSQL_UNIX_ADDR=/usr/local/mysql/mysql.sock 
  #安装 myisam 存储引擎
  -DWITH_MYISAM_STORAGE_ENGINE=1
  #安装 innodb 存储引擎
  -DWITH_INNOBASE_STORAGE_ENGINE=1 
  #安装 archive 存储引擎
  -DWITH_ARCHIVE_STORAGE_ENGINE=1 
  #安装 blackhole 存储引擎
  -DWITH_BLACKHOLE_STORAGE_ENGINE=1
  #安装数据库分区
  -DWITH_PARTITION_STORAGE_ENGINE=1 
  #允许从本地导入数据
  -DENABLED_LOCAL_INFILE=1
  #快捷键功能
  -DWITH_READLINE=1
  #支持 SSL
  -DWITH_SSL=yes
  #使用 utf8 字符
  -DDEFAULT_CHARSET=utf8 
  #校验字符
  -DDEFAULT_COLLATION=utf8_general_ci
  #安装所有扩展字符集
  -DEXTRA_CHARSETS=all
  #MySQL 监听端口
  -DMYSQL_TCP_PORT=3306
  ```

- 安装过程8

  >
  >
  >编译出错：删除``CMakeCache.txt`文件，重新编译

  ```
  cmake [源码包解压目录] 配置参数
  echo $?
  make
  echo $?
  make install
  echo $?
  ```

- 设置不带版本号的软链接（可选）

  ```
  ln -s /application/mysql-5.6.50 /application/mysql
  ```
  
- 如何判断是否安装成功？

  >`/application/mysql`下有内容（你安装的MySQL路径下有内容）

![image-20210927161159472](C:\Users\LGB\AppData\Roaming\Typora\typora-user-images\image-20210927161159472.png)

### 2.4 创建MySQL数据库配置文件，并对数据库目录授权

>MySQL配置文件设置
>
>数据库授权处理：更改为`mysql组、用户mysql`

#### 2.4.1 MySQL配置文件

- 更改系统默认配置文件：`/etc/my.cnf -->  /etc/my.cnf.bak`

  ```
  mv /etc/my.cnf /etc/my.cnf.bak
  ```

#### 2.4.2 授权mysql用户管理mysql安装目录

```
chown -R mysql:mysql /application/mysql/
```

### 2.5 初始化数据库文件 – – 创建基础的数据库系统文件（`./data`目录下），如MySQL库表；

>`--basedir=/application/mysql/`：MySQL安装路径
>
>`–-datadir=/application/mysql/data`：数据文件目录
>
>`--user=mysql`

```
[root@centos7001 mysql-5.6.50]# /application/mysql-5.6.50/scripts/mysql_install_db 
--basedir=/application/mysql/ 
--datadir=/application/mysql/data 
--user=mysql
# 查看初始化数据目录
[root@centos7001 data]# ll /application/mysql-5.6.50/data/


```

- 出现俩个“OK”即可

  ![image-20210927182017796](H:\笔记\Note_Code\images\image-20210927182017796.png)

- 初始化数据库数据目录

  ![image-20210927183702676](H:\笔记\Note_Code\images\初始化数据目录.png)

- ❓出现问题：https://blog.csdn.net/u012965373/article/details/51848402![image-20210927180831983](H:\笔记\Note_Code\images\image-20210927180831983.png)

  解决：安装`autoconf`模块

  ```
  [root@centos7001 mysql-5.6.50]# yum install autoconf -y
  
  ```

### 2.6 配置并启动MySQL数据库

```
# 将MySQL启动脚本复制到MySQL命令路径
[root@centos7001 support-files]# cp ./mysql.server /etc/init.d/mysqld
# 更改脚本为可执行
[root@centos7001 support-files]# chmod 700 /etc/init.d/mysqld 

```

#### 2.6.1 启动MySQL服务

- 第一种

  ```
  [root@centos7001 mysql-5.6.50]# /etc/init.d/mysqld start
  # 查看是否完成启动
  [root@centos7001 mysql-5.6.50]# netstat -lntup | grep mysql
  
  ```

- 第二种

  ```
  # 一定要后台运行-
  [root@centos7001 application]# /application/mysql/bin/mysqld --user=mysql &
  
  ```

#### 2.6.4 设置开机自启

```
# 添加自启名单
[root@centos7001 support-files]# chkconfig --add mysqld
# 查看
[root@centos7001 support-files]# chkconfig --list mysqld

```



#### 2.6.3 查看数据库启动结果日志

>
>
>如出现错误，显示`error`

```
# 查看给出的默认10h
[root@centos7001 data]# tail /application/mysql/data/centos7001.err 

```

### 2.7 将`mysql命令`添加到全局 – –

> 务必将MySQL命令路径添加到其他路径前面
>
>1、添加之全局环境变量
>
>2、建立软连接

```
# 添加，安装MySQL路径下的bin目录加入全局，追加到/etc/profile
[root@centos7001 ~]# echo 'export PATH=/application/mysql/bin:$PATH' >> /etc/profile
# 使得添加内容生效
[root@centos7001 ~]# source /etc/profile
# 查看全局变量
[root@centos7001 ~]# echo $PATH

```

![image-20210928102158833](C:\Users\LGB\AppData\Roaming\Typora\typora-user-images\image-20210928102158833.png)

